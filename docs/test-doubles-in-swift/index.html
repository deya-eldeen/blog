<!DOCTYPE html>
<!--
    Type on Strap jekyll theme v2.4.9
    Theme free for personal and commercial use under the MIT license
    https://github.com/sylhare/Type-on-Strap/blob/master/LICENSE
-->
<html lang="en">
  
  <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=0.5, maximum-scale=5"> <!-- Theme Mode--> <script> const darkBtn = "Dark"; const lightBtn = "Light"; const isAutoTheme = true; const preferredTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'; if (isAutoTheme) { document.documentElement.setAttribute('data-theme', sessionStorage.getItem('theme') ?? preferredTheme); } else { document.documentElement.setAttribute('data-theme', "auto"); } </script> <!-- Main JS (navbar.js, katex_init.js and masonry_init.js)--> <script defer src="/assets/js/main.min.js"></script> <!-- CSS --> <!-- <link rel="stylesheet" href="/assets/css/main.css"> --> <link rel="stylesheet" href="http://localhost:4000/assets/css/main.css"> <!--Favicon--> <link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon"> <!-- KaTeX 0.16.9 --> <!-- Mermaid 10.8.0 --> <link rel="alternate" hreflang="en" href="http://localhost:4000/en/" /> <link rel="alternate" hreflang="fr" href="http://localhost:4000/fr/" /> <link rel="alternate" hreflang="es" href="http://localhost:4000/es/" /> <link rel="alternate" hreflang="x-default" href="http://localhost:4000" /> <!-- Simple Jekyll Search 1.10.0 --> <script src="/assets/js/vendor/simple-jekyll-search.min.js" type="text/javascript"></script> <!-- Google Analytics / Cookie Consent --> <script> const cookieName = 'cookie-notice-dismissed-http://localhost:4000'; const isCookieConsent = 'true'; const analyticsName = ''; const analyticsNameGA4 = ''; </script> <span id="cookie-notice"><span>We would like to use third party cookies and scripts to improve the functionality of this website. </span><a id="cookie-notice-accept" class="button">Approve</a> </span> <!-- seo tags --> <meta property="og:image" content="http://localhost:4000/images/covers/test_doubles.webp"> <meta property="og:type" content="website" /> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Test Doubles In Swift | Swift By Deya</title> <meta name="generator" content="Jekyll v4.3.3" /> <meta property="og:title" content="Test Doubles In Swift" /> <meta name="author" content="Deya Elkhawaldeh" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="The term test doubles draws inspiration from stunt doubles in the movie industry, where a stunt double steps in to perform dangerous or complex tasks, allowing the actor to focus on their role. Similarly, in software testing, test doubles step in to replace real components, making testing simpler, faster, and more reliable. Testing is an essential part of software development, ensuring the correctness and reliability of our code. However, when we test systems with many dependencies—like databases, web services, or external APIs—writing reliable tests can become challenging. This is where test doubles come in handy." /> <meta property="og:description" content="The term test doubles draws inspiration from stunt doubles in the movie industry, where a stunt double steps in to perform dangerous or complex tasks, allowing the actor to focus on their role. Similarly, in software testing, test doubles step in to replace real components, making testing simpler, faster, and more reliable. Testing is an essential part of software development, ensuring the correctness and reliability of our code. However, when we test systems with many dependencies—like databases, web services, or external APIs—writing reliable tests can become challenging. This is where test doubles come in handy." /> <link rel="canonical" href="http://localhost:4000/test-doubles-in-swift/" /> <meta property="og:url" content="http://localhost:4000/test-doubles-in-swift/" /> <meta property="og:site_name" content="Swift By Deya" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2023-10-25T00:00:00+03:00" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Test Doubles In Swift" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Deya Elkhawaldeh"},"dateModified":"2024-09-08T00:00:00+03:00","datePublished":"2023-10-25T00:00:00+03:00","description":"The term test doubles draws inspiration from stunt doubles in the movie industry, where a stunt double steps in to perform dangerous or complex tasks, allowing the actor to focus on their role. Similarly, in software testing, test doubles step in to replace real components, making testing simpler, faster, and more reliable. Testing is an essential part of software development, ensuring the correctness and reliability of our code. However, when we test systems with many dependencies—like databases, web services, or external APIs—writing reliable tests can become challenging. This is where test doubles come in handy.","headline":"Test Doubles In Swift","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/test-doubles-in-swift/"},"url":"http://localhost:4000/test-doubles-in-swift/"}</script> <!-- End Jekyll SEO tag --> <!-- RSS --> <link rel="alternate" type="application/atom+xml" title="Swift By Deya" href="http://localhost:4000/feed.xml"/> <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Swift By Deya" /> <!-- Twitter Cards --> <meta name="twitter:title" content="Test Doubles In Swift"> <meta name="twitter:description" content="The term test doubles draws inspiration from stunt doubles in the movie industry, where a stunt double steps in to perform dangerous or complex tasks, allowi..."> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:image" content="http://localhost:4000/images/covers/test_doubles.webp"> <meta name="twitter:image:alt" content="Test Doubles In Swift"> </head>
  <body>
    
    <header class="site-header"> <!-- Logo and title --> <div class="branding"> <a href="/"> <img alt="logo img" class="avatar" src="/assets/img/swift.webp" loading="lazy"/> </a> <a class="site-title" aria-label="Swift By Deya" href="/"> Swift By Deya </a> </div> <!-- Toggle menu --> <nav class="clear"> <a aria-label="pull" id="pull" class="toggle" href="#"> <i class="fas fa-bars fa-lg"></i> </a> <!-- Menu --> <ul class="hide"> <li class="separator"> | </li> <li> <a class="clear" aria-label="Books" title="Books" href="/books/"> <span class="navbar-label ">Books</span> </a> </li> <li class="separator"> | </li> <li> <a class="clear" aria-label="Roadmaps" title="Roadmaps" href="/ios-road-map/"> <span class="navbar-label ">Roadmaps</span> </a> </li> <li class="separator"> | </li> <li> <a class="clear" aria-label="About Me" title="About Me" href="/about-me/"> <span class="navbar-label ">About Me</span> </a> </li> <li class="separator"> | </li> <li> <a class="clear" aria-label="Tags" title="Tags" href="/tag/"> <i class="navbar-icon fas fa-tags" aria-hidden="true"></i> <span class="navbar-label navbar-label-with-icon">Tags</span> </a> </li> <li class="separator"> | </li> <li> <a class="clear" aria-label="Blog Archive" title="Blog Archive" href="/archive/"> <i class="navbar-icon fas fa-archive" aria-hidden="true"></i> <span class="navbar-label navbar-label-with-icon">Blog Archive</span> </a> </li> <li class="separator"> | </li> <li> <a class="clear" aria-label="Search" title="Search" href="/search/"> <i class="navbar-icon fas fa-search" aria-hidden="true"></i> <span class="navbar-label navbar-label-with-icon">Search</span> </a> </li> <li class="separator"> | </li> <!-- <li><a id="theme-toggle" title="Test Doubles In Swift " aria-label="Test Doubles In Swift" onclick="themeToggle()"></a></li> --> </ul> </nav> </header>
    <div class="content">
      <article >
    <header id="main" style="">
        <div class="title-padder">
            
                <h1 id="Test+Doubles+In+Swift" class="title">Test Doubles In Swift</h1>
                


<div class="post-info">
      <img alt="Author's avatar" src="/images/deya_64.webp" loading="lazy">
    
    <p class="meta">
      Deya Elkhawaldeh - 
      
      October 25, 2023
    </p></div>

            
        </div>
    </header>

    <section class="post-content">
    
            <p>The term <strong>test doubles</strong> draws inspiration from <strong>stunt doubles</strong> in the movie industry, where a stunt double steps in to perform dangerous or complex tasks, allowing the actor to focus on their role. Similarly, in software testing, test doubles step in to replace real components, making testing simpler, faster, and more reliable.</p>

<p>Testing is an essential part of software development, ensuring the correctness and reliability of our code. However, when we test systems with many dependencies—like databases, web services, or external APIs—writing reliable tests can become challenging. This is where test doubles come in handy.</p>

<!--more-->

<!-- _includes/centered-image.html -->
<div class="centered-image">
  <img src="../images/covers/test_doubles_full.webp" alt="" class="centered-image__img" width="960" height="1568" />
  <p align="center">
    <em></em>
  </p>
</div>

<p>It’s important to understand the basics of unit testing, see this blog post <a href="http://localhost:4000/gentle-introduction-to-unit-testing/">Gentle Introduction to Unit Testing</a>, especially since certain architectural patterns, like MVC can introduce complexities that make them less testable. Familiarity with the FIRST principles—Fast, Independent, Repeatable, Self-validating, and Timely—is crucial for writing effective tests. Additionally, it’s vital to recognize that flaky tests, which produce inconsistent results, can undermine the reliability of your testing suite and lead to wasted time and effort.</p>

<p>In this post, we’ll explore the different types of test doubles, their purpose, and practical examples. By the end, you’ll be able to confidently use them to create more effective, reliable tests.</p>

<h2 id="what-is-a-test-double">What is a Test Double?</h2>
<p>A <strong>test double</strong> is a substitute that stands in for a real dependency during testing. These dependencies, which can include external services, databases, or complex components, often introduce complexity that makes testing challenging. Test doubles enable us to isolate the code under test and concentrate on specific behaviors, resulting in more predictable and efficient tests. By using test doubles, we can create controlled environments that facilitate thorough testing without the overhead of managing real dependencies. This revision broadens the definition of a test double while maintaining clarity and focus on its purpose in testing.</p>

<p>Test doubles mimic the behavior of real dependencies, but they provide simplified or controlled implementations. By replacing real dependencies with test doubles, we create an environment where we control every interaction, avoiding side effects from external systems.</p>

<h3 id="types-of-test-doubles">Types of Test Doubles</h3>

<p>There are five common types of test doubles, each serving a distinct purpose:</p>

<ol>
  <li><strong>Dummy</strong></li>
  <li><strong>Fake</strong></li>
  <li><strong>Stub</strong></li>
  <li><strong>Spy</strong></li>
  <li><strong>Mock</strong></li>
</ol>

<p>Let’s dive into each of these with practical Swift examples. We’ll use a sample <code class="language-plaintext highlighter-rouge">UserManager</code> class that has dependencies carefully picked for demonstrating all types of test doubles, it may be needed to create multiple test doubles of different types for each dependency in some cases, this depends on the test cases needs, but in this example, only one test double is created for each dependency, for demo purpose.</p>

<p><code class="language-plaintext highlighter-rouge">UserManager</code> also uses default values that can be changed, this is dependency injection by init.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// UserManager.swift</span>
<span class="kd">class</span> <span class="kt">UserManager</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">loggerService</span><span class="p">:</span> <span class="kt">LoggerService</span>
    <span class="k">let</span> <span class="nv">cacheService</span><span class="p">:</span> <span class="kt">CacheService</span>
    <span class="k">let</span> <span class="nv">database</span><span class="p">:</span> <span class="kt">DatabaseHelper</span>
    <span class="k">let</span> <span class="nv">securityHelper</span><span class="p">:</span> <span class="kt">SecurityHelper</span>
    <span class="k">let</span> <span class="nv">notificationService</span><span class="p">:</span> <span class="kt">NotificationService</span>

    <span class="nf">init</span><span class="p">(</span>
        <span class="nv">logger</span><span class="p">:</span> <span class="kt">LoggerService</span> <span class="o">=</span> <span class="kt">LoggerServiceImpl</span><span class="p">(),</span>
        <span class="nv">cache</span><span class="p">:</span> <span class="kt">CacheService</span> <span class="o">=</span> <span class="kt">CacheServiceImpl</span><span class="p">(),</span>
        <span class="nv">database</span><span class="p">:</span> <span class="kt">DatabaseHelper</span> <span class="o">=</span> <span class="kt">DatabaseHelperImpl</span><span class="p">(),</span>
        <span class="nv">securityHelper</span><span class="p">:</span> <span class="kt">SecurityHelper</span> <span class="o">=</span> <span class="kt">SecurityHelperImpl</span><span class="p">(),</span>
        <span class="nv">notificationService</span><span class="p">:</span> <span class="kt">NotificationService</span> <span class="o">=</span> <span class="kt">NotificationServiceImpl</span><span class="p">()</span>
    <span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">loggerService</span> <span class="o">=</span> <span class="n">logger</span>
        <span class="k">self</span><span class="o">.</span><span class="n">cacheService</span> <span class="o">=</span> <span class="n">cache</span>
        <span class="k">self</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="n">database</span>
        <span class="k">self</span><span class="o">.</span><span class="n">securityHelper</span> <span class="o">=</span> <span class="n">securityHelper</span>
        <span class="k">self</span><span class="o">.</span><span class="n">notificationService</span> <span class="o">=</span> <span class="n">notificationService</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">authenticate</span><span class="p">(</span><span class="nv">username</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">password</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="n">loggerService</span><span class="o">.</span><span class="nf">log</span><span class="p">(</span><span class="s">"Authenticating user </span><span class="se">\(</span><span class="n">username</span><span class="se">)</span><span class="s"> </span><span class="se">\(</span><span class="n">password</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        
        <span class="c1">// Check cache first</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">cachedPasswordHash</span> <span class="o">=</span> <span class="n">cacheService</span><span class="o">.</span><span class="nf">get</span><span class="p">(</span><span class="n">username</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">loggerService</span><span class="o">.</span><span class="nf">log</span><span class="p">(</span><span class="s">"Cache hit for user </span><span class="se">\(</span><span class="n">username</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="k">let</span> <span class="nv">success</span> <span class="o">=</span> <span class="n">cachedPasswordHash</span> <span class="o">==</span> <span class="n">password</span><span class="o">.</span><span class="nf">hashed</span><span class="p">()</span>
            <span class="n">securityHelper</span><span class="o">.</span><span class="nf">recordAuthenticationAttempt</span><span class="p">(</span><span class="nv">username</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span> <span class="nv">success</span><span class="p">:</span> <span class="n">success</span><span class="p">)</span>
            <span class="n">notificationService</span><span class="o">.</span><span class="nf">sendAuthenticationEmail</span><span class="p">(</span><span class="nv">username</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span> <span class="nv">success</span><span class="p">:</span> <span class="n">success</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">success</span>
        <span class="p">}</span>
        
        <span class="c1">// Fetch from database if not in cache</span>
        <span class="n">loggerService</span><span class="o">.</span><span class="nf">log</span><span class="p">(</span><span class="s">"Cache miss for user </span><span class="se">\(</span><span class="n">username</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">passwordHash</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="nf">getUserPasswordHash</span><span class="p">(</span><span class="nv">username</span><span class="p">:</span> <span class="n">username</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">cacheService</span><span class="o">.</span><span class="nf">set</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="nv">value</span><span class="p">:</span> <span class="n">passwordHash</span><span class="p">)</span>
            <span class="k">let</span> <span class="nv">success</span> <span class="o">=</span> <span class="n">passwordHash</span> <span class="o">==</span> <span class="n">password</span><span class="o">.</span><span class="nf">hashed</span><span class="p">()</span>
            <span class="n">securityHelper</span><span class="o">.</span><span class="nf">recordAuthenticationAttempt</span><span class="p">(</span><span class="nv">username</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span> <span class="nv">success</span><span class="p">:</span> <span class="n">success</span><span class="p">)</span>
            <span class="n">notificationService</span><span class="o">.</span><span class="nf">sendAuthenticationEmail</span><span class="p">(</span><span class="nv">username</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span> <span class="nv">success</span><span class="p">:</span> <span class="n">success</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">success</span>
        <span class="p">}</span>
        
        <span class="n">loggerService</span><span class="o">.</span><span class="nf">log</span><span class="p">(</span><span class="s">"Authentication failed for user </span><span class="se">\(</span><span class="n">username</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="n">securityHelper</span><span class="o">.</span><span class="nf">recordAuthenticationAttempt</span><span class="p">(</span><span class="nv">username</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span> <span class="nv">success</span><span class="p">:</span> <span class="kc">false</span><span class="p">)</span>
        <span class="n">notificationService</span><span class="o">.</span><span class="nf">sendFailedAuthenticationAttemptEmail</span><span class="p">(</span><span class="nv">username</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span> <span class="nv">success</span><span class="p">:</span> <span class="kc">false</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">register</span><span class="p">(</span><span class="nv">username</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">password</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="c1">// Check if the username is valid</span>
        <span class="k">guard</span> <span class="o">!</span><span class="n">username</span><span class="o">.</span><span class="n">isEmpty</span><span class="p">,</span> <span class="o">!</span><span class="n">password</span><span class="o">.</span><span class="n">isEmpty</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">loggerService</span><span class="o">.</span><span class="nf">log</span><span class="p">(</span><span class="s">"Registration failed: Username or password is empty."</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">false</span>
        <span class="p">}</span>
        
        <span class="c1">// Check if the username already exists in the database</span>
        <span class="k">if</span> <span class="n">database</span><span class="o">.</span><span class="nf">getUserPasswordHash</span><span class="p">(</span><span class="nv">username</span><span class="p">:</span> <span class="n">username</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="n">loggerService</span><span class="o">.</span><span class="nf">log</span><span class="p">(</span><span class="s">"Registration failed: Username </span><span class="se">\(</span><span class="n">username</span><span class="se">)</span><span class="s"> already exists."</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">false</span> <span class="c1">// Username already taken</span>
        <span class="p">}</span>
        
        <span class="c1">// Hash the password for storage</span>
        <span class="k">let</span> <span class="nv">passwordHash</span> <span class="o">=</span> <span class="n">password</span><span class="o">.</span><span class="nf">hashed</span><span class="p">()</span>
        
        <span class="c1">// Add the user to the database</span>
        <span class="n">database</span><span class="o">.</span><span class="nf">addUser</span><span class="p">(</span><span class="nv">username</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span> <span class="nv">passwordHash</span><span class="p">:</span> <span class="n">passwordHash</span><span class="p">)</span>
        
        <span class="c1">// Optionally, cache the newly created user</span>
        <span class="n">cacheService</span><span class="o">.</span><span class="nf">set</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="nv">value</span><span class="p">:</span> <span class="n">passwordHash</span><span class="p">)</span>
        
        <span class="c1">// Log the successful registration</span>
        <span class="n">loggerService</span><span class="o">.</span><span class="nf">log</span><span class="p">(</span><span class="s">"User </span><span class="se">\(</span><span class="n">username</span><span class="se">)</span><span class="s"> registered successfully."</span><span class="p">)</span>
        
        <span class="c1">// Send a notification email (optional)</span>
        <span class="n">notificationService</span><span class="o">.</span><span class="nf">sendRegistrationEmail</span><span class="p">(</span><span class="nv">username</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span> <span class="nv">success</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="kc">true</span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre></div></div>

<p>Below you can see the protocols used to create our dependencies, for example the <code class="language-plaintext highlighter-rouge">LoggerService</code> protocol can be used to either created a <code class="language-plaintext highlighter-rouge">LoggerServiceImpl</code> or <code class="language-plaintext highlighter-rouge">DummyLogger</code>, and the same goes for other dependencies, each protocol can be used to create either an implementation or a test double, this way we ensure the code is properly testable, we can simply plug in whatever needed in the <code class="language-plaintext highlighter-rouge">UserManager</code>.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// LoggerService.swift</span>
<span class="kd">protocol</span> <span class="kt">LoggerService</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">log</span><span class="p">(</span><span class="n">_</span> <span class="nv">message</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>
<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// CacheService.swift</span>
<span class="kd">protocol</span> <span class="kt">CacheService</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">get</span><span class="p">(</span><span class="n">_</span> <span class="nv">key</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">String</span><span class="p">?</span>
    <span class="kd">func</span> <span class="nf">set</span><span class="p">(</span><span class="n">_</span> <span class="nv">key</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">value</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>
<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// DatabaseHelper.swift</span>
<span class="kd">protocol</span> <span class="kt">DatabaseHelper</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">getUserPasswordHash</span><span class="p">(</span><span class="nv">username</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">String</span><span class="p">?</span>
    <span class="kd">func</span> <span class="nf">addUser</span><span class="p">(</span><span class="nv">username</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">passwordHash</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>
<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// SecurityHelper.swift</span>
<span class="kd">protocol</span> <span class="kt">SecurityHelper</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">recordAuthenticationAttempt</span><span class="p">(</span><span class="nv">username</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">success</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>
<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// NotificationService.swift</span>
<span class="kd">protocol</span> <span class="kt">NotificationService</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">sendAuthenticationEmail</span><span class="p">(</span><span class="nv">username</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">success</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">)</span>
    <span class="kd">func</span> <span class="nf">sendRegistrationEmail</span><span class="p">(</span><span class="nv">username</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">success</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">)</span>
    <span class="kd">func</span> <span class="nf">sendFailedAuthenticationAttemptEmail</span><span class="p">(</span><span class="nv">username</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">success</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Below is a simple hasher, this is simplified for demo purpose.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// String+Hasher.swift</span>
<span class="kd">extension</span> <span class="kt">String</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">hashed</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">String</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">"hashed_</span><span class="se">\(</span><span class="k">self</span><span class="se">)</span><span class="s">"</span> <span class="c1">// Simplified hash for demo purpose.</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Below you can find the implementations we will be using in production code, this is useful to compare when reading about the test double examples.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// LoggerServiceImpl.swift</span>
<span class="kd">class</span> <span class="kt">LoggerServiceImpl</span><span class="p">:</span> <span class="kt">LoggerService</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="k">let</span> <span class="nv">logger</span> <span class="o">=</span> <span class="kt">Logger</span><span class="p">(</span><span class="nv">subsystem</span><span class="p">:</span> <span class="kt">Bundle</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">bundleIdentifier</span> <span class="p">??</span> <span class="s">"com.yourapp"</span><span class="p">,</span> <span class="nv">category</span><span class="p">:</span> <span class="s">"default"</span><span class="p">)</span>
    <span class="kd">func</span> <span class="nf">log</span><span class="p">(</span><span class="n">_</span> <span class="nv">message</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">logger</span><span class="o">.</span><span class="nf">log</span><span class="p">(</span><span class="s">"Log: </span><span class="se">\(</span><span class="n">message</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// CacheServiceImpl.swift</span>
<span class="kd">class</span> <span class="kt">CacheServiceImpl</span><span class="p">:</span> <span class="kt">CacheService</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="k">var</span> <span class="nv">cache</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">String</span><span class="p">]</span> <span class="o">=</span> <span class="p">[:]</span>
    
    <span class="kd">func</span> <span class="nf">get</span><span class="p">(</span><span class="n">_</span> <span class="nv">key</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">String</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">cache</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="c1">// Retrieve value from cache</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">set</span><span class="p">(</span><span class="n">_</span> <span class="nv">key</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">value</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cache</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span> <span class="c1">// Store value in cache</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// DatabaseHelperImpl.swift</span>
<span class="kd">class</span> <span class="kt">DatabaseHelperImpl</span><span class="p">:</span> <span class="kt">DatabaseHelper</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="k">var</span> <span class="nv">users</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">String</span><span class="p">]</span> <span class="o">=</span> <span class="p">[:]</span> <span class="c1">// Simulated user password storage</span>
    
    <span class="kd">func</span> <span class="nf">getUserPasswordHash</span><span class="p">(</span><span class="nv">username</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">String</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">users</span><span class="p">[</span><span class="n">username</span><span class="p">]</span> <span class="c1">// Retrieve password hash for the given username</span>
    <span class="p">}</span>
    
    <span class="c1">// Helper method to add users to the database for testing purposes</span>
    <span class="kd">func</span> <span class="nf">addUser</span><span class="p">(</span><span class="nv">username</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">passwordHash</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">users</span><span class="p">[</span><span class="n">username</span><span class="p">]</span> <span class="o">=</span> <span class="n">passwordHash</span> <span class="c1">// Add user to the simulated database</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// SecurityHelperImpl.swift</span>
<span class="kd">class</span> <span class="kt">SecurityHelperImpl</span><span class="p">:</span> <span class="kt">SecurityHelper</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="k">let</span> <span class="nv">logFileURL</span><span class="p">:</span> <span class="kt">URL</span>
    
    <span class="nf">init</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">documentsURL</span> <span class="o">=</span> <span class="kt">FileManager</span><span class="o">.</span><span class="k">default</span><span class="o">.</span><span class="nf">urls</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="o">.</span><span class="n">documentDirectory</span><span class="p">,</span> <span class="nv">in</span><span class="p">:</span> <span class="o">.</span><span class="n">userDomainMask</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="o">!</span>
        <span class="n">logFileURL</span> <span class="o">=</span> <span class="n">documentsURL</span><span class="o">.</span><span class="nf">appendingPathComponent</span><span class="p">(</span><span class="s">"authentication_log.txt"</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">recordAuthenticationAttempt</span><span class="p">(</span><span class="nv">username</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">success</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">logEntry</span> <span class="o">=</span> <span class="s">"</span><span class="se">\(</span><span class="kt">Date</span><span class="p">()</span><span class="se">)</span><span class="s">: Authentication attempt for </span><span class="se">\(</span><span class="n">username</span><span class="se">)</span><span class="s">: </span><span class="se">\(</span><span class="n">success</span> <span class="p">?</span> <span class="s">"Success"</span> <span class="p">:</span> <span class="s">"Failure"</span><span class="se">)\n</span><span class="s">"</span>
        
        <span class="k">do</span> <span class="p">{</span>
            <span class="k">try</span> <span class="n">logEntry</span><span class="o">.</span><span class="nf">write</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="n">logFileURL</span><span class="p">,</span> <span class="nv">atomically</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Error writing to log file: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">readAuthenticationAttempts</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="p">[(</span><span class="nv">username</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">success</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">)]</span> <span class="p">{</span>
        <span class="k">var</span> <span class="nv">attempts</span><span class="p">:</span> <span class="p">[(</span><span class="nv">username</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">success</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">do</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">logContents</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">String</span><span class="p">(</span><span class="nv">contentsOf</span><span class="p">:</span> <span class="n">logFileURL</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span>
            <span class="k">let</span> <span class="nv">lines</span> <span class="o">=</span> <span class="n">logContents</span><span class="o">.</span><span class="nf">split</span><span class="p">(</span><span class="nv">separator</span><span class="p">:</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
            
            <span class="k">for</span> <span class="n">line</span> <span class="k">in</span> <span class="n">lines</span> <span class="p">{</span>
                <span class="c1">// Parse each line to extract the username and success status</span>
                <span class="k">let</span> <span class="nv">components</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="nf">split</span><span class="p">(</span><span class="nv">separator</span><span class="p">:</span> <span class="s">":"</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">components</span><span class="o">.</span><span class="n">count</span> <span class="o">&gt;=</span> <span class="mi">3</span> <span class="p">{</span>
                    <span class="k">let</span> <span class="nv">username</span> <span class="o">=</span> <span class="n">components</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="nf">split</span><span class="p">(</span><span class="nv">separator</span><span class="p">:</span> <span class="s">" "</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span> <span class="c1">// Extract the username</span>
                    <span class="k">let</span> <span class="nv">successString</span> <span class="o">=</span> <span class="n">components</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="nf">trimmingCharacters</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="o">.</span><span class="n">whitespaces</span><span class="p">)</span> <span class="c1">// Extract "Success" or "Failure"</span>
                    <span class="k">let</span> <span class="nv">success</span> <span class="o">=</span> <span class="n">successString</span> <span class="o">==</span> <span class="s">"Success"</span>
                    <span class="n">attempts</span><span class="o">.</span><span class="nf">append</span><span class="p">((</span><span class="nv">username</span><span class="p">:</span> <span class="kt">String</span><span class="p">(</span><span class="n">username</span><span class="p">),</span> <span class="nv">success</span><span class="p">:</span> <span class="n">success</span><span class="p">))</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Error reading log file: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
        
        <span class="k">return</span> <span class="n">attempts</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// NotificationServiceImpl.swift</span>
<span class="kd">class</span> <span class="kt">NotificationServiceImpl</span><span class="p">:</span> <span class="kt">NotificationService</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">sendAuthenticationEmail</span><span class="p">(</span><span class="nv">username</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">success</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Here you could implement logic to send an email notification</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Sent authentication email to </span><span class="se">\(</span><span class="n">username</span><span class="se">)</span><span class="s">: </span><span class="se">\(</span><span class="n">success</span> <span class="p">?</span> <span class="s">"Success"</span> <span class="p">:</span> <span class="s">"Failure"</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">sendFailedAuthenticationAttemptEmail</span><span class="p">(</span><span class="nv">username</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">success</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Here you could implement logic to send an email notification for a failed attempt</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Sent failed authentication attempt email to </span><span class="se">\(</span><span class="n">username</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">sendRegistrationEmail</span><span class="p">(</span><span class="nv">username</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">success</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Here you could implement logic to send an email notification for registration</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Sent registration email to </span><span class="se">\(</span><span class="n">username</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>After getting familiar with <code class="language-plaintext highlighter-rouge">UserManager</code>, Let’s explore the different types of test doubles, along with examples and further details.</p>

<h2 id="1-dummies">1. Dummies</h2>

<p>A <strong>dummy</strong> test double is the simplest form of a test double. It’s used when a parameter is required by the method signature but isn’t actually used by the method itself. It’s essentially a placeholder to satisfy the API.</p>

<h3 id="example">Example:</h3>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// DummyLogger.swift</span>
<span class="kd">class</span> <span class="kt">DummyLogger</span><span class="p">:</span> <span class="kt">LoggerService</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">log</span><span class="p">(</span><span class="n">_</span> <span class="nv">message</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// No-op: This dummy logger does nothing</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>In this example, <code class="language-plaintext highlighter-rouge">DummyLogger</code> is a <strong>dummy</strong> that satisfies the <code class="language-plaintext highlighter-rouge">LoggerService</code> protocol, but doesn’t actually perform any actions. It’s only used to fulfill the constructor requirements, notice that it has no <code class="language-plaintext highlighter-rouge">Logger</code>, in the unit tests cases, you can see the usage of that dummy, only to satisfy the needs we have.</p>

<p>If we had a complicated logging system that is supposed to be tested, we simply create another test double for the <code class="language-plaintext highlighter-rouge">LoggerService</code>, but again, we are trying to demonstrate the different types of test doubles, and the logger in this case seems to be the most simple dependency.</p>

<h2 id="2-fakes">2. Fakes</h2>

<p>A <strong>fake</strong> object provides a working implementation, but it is simpler and often less efficient than the real one. Fakes are often used to simulate databases or services during testing.</p>

<h3 id="example-1">Example:</h3>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="kt">FakeDatabase</span><span class="p">:</span> <span class="kt">DatabaseHelper</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">users</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">String</span><span class="p">]</span> <span class="o">=</span> <span class="p">[:]</span> <span class="c1">// Simulated user password storage</span>
    
    <span class="kd">func</span> <span class="nf">getUserPasswordHash</span><span class="p">(</span><span class="nv">username</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">String</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">users</span><span class="p">[</span><span class="n">username</span><span class="p">]</span>
    <span class="p">}</span>
    
    <span class="c1">// Helper method to add users to the fake database</span>
    <span class="kd">func</span> <span class="nf">addUser</span><span class="p">(</span><span class="nv">username</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">passwordHash</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">users</span><span class="p">[</span><span class="n">username</span><span class="p">]</span> <span class="o">=</span> <span class="n">passwordHash</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Here, the <code class="language-plaintext highlighter-rouge">FakeDatabase</code> simulates a database with an in-memory data structure, making it useful for testing without involving a real database. The original implementation is similar due to the demo-purpose, we can have the original implementation to really talk to a simple sqlite database or a coredata database.</p>

<p>The fake test double only does a dictionary manipulation, using an original database example will make this blog post very lengthy, in the next example we can see a usage of user defaults.</p>

<h2 id="3-stubs">3. Stubs</h2>

<p>A <strong>stub</strong> is a test double that provides predefined answers to method calls. Stubs don’t perform any logic; they just return canned responses. Stubs are helpful when you want to control the return values of a dependency in a test scenario.</p>

<h3 id="example-2">Example:</h3>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// StubCache.swift</span>
<span class="kd">class</span> <span class="kt">StubCache</span><span class="p">:</span> <span class="kt">CacheService</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">storedData</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">String</span><span class="p">]</span> <span class="o">=</span> <span class="p">[:]</span>
    
    <span class="kd">func</span> <span class="nf">get</span><span class="p">(</span><span class="n">_</span> <span class="nv">key</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">String</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">storedData</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="c1">// Simulates cache hit or miss</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">set</span><span class="p">(</span><span class="n">_</span> <span class="nv">key</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">value</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">storedData</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span> <span class="c1">// Simulates setting a value in the cache</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>If we compare with the original implementation, stubs use a dictionary to store data, instead of using <code class="language-plaintext highlighter-rouge">UserDefaults</code>.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// CacheServiceImpl.swift</span>
<span class="kd">class</span> <span class="kt">CacheServiceImpl</span><span class="p">:</span> <span class="kt">CacheService</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="k">let</span> <span class="nv">userDefaults</span> <span class="o">=</span> <span class="kt">UserDefaults</span><span class="o">.</span><span class="n">standard</span>
    
    <span class="kd">func</span> <span class="nf">get</span><span class="p">(</span><span class="n">_</span> <span class="nv">key</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">String</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">userDefaults</span><span class="o">.</span><span class="nf">string</span><span class="p">(</span><span class="nv">forKey</span><span class="p">:</span> <span class="n">key</span><span class="p">)</span> <span class="c1">// Retrieve value from UserDefaults</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">set</span><span class="p">(</span><span class="n">_</span> <span class="nv">key</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">value</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">userDefaults</span><span class="o">.</span><span class="nf">set</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="n">key</span><span class="p">)</span> <span class="c1">// Store value in UserDefaults</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<blockquote>
  <p>Note: Stubs provide canned responses to method calls, while fakes provide a simplified implementation of the real thing.</p>
</blockquote>

<blockquote>
  <p>Note: the usage of UserDefaults should not be used with critical data storage like passwords, even if hashed, this is only for demo purpose.</p>
</blockquote>

<h2 id="4-spies">4. Spies</h2>

<p>A <strong>spy</strong> is a test double that records information about the interactions with its methods, such as how many times a method was called or with what arguments. This makes it useful for verifying side effects in your tests.</p>

<h3 id="example-3">Example:</h3>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// SpySecurityHelper.swift</span>
<span class="kd">class</span> <span class="kt">SpySecurityHelper</span><span class="p">:</span> <span class="kt">SecurityHelper</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">recordedAttempts</span><span class="p">:</span> <span class="p">[(</span><span class="nv">username</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">success</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="kd">func</span> <span class="nf">recordAuthenticationAttempt</span><span class="p">(</span><span class="nv">username</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">success</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">recordedAttempts</span><span class="o">.</span><span class="nf">append</span><span class="p">((</span><span class="n">username</span><span class="p">,</span> <span class="n">success</span><span class="p">))</span>
    <span class="p">}</span>
    
    <span class="c1">// Helper method to check whether a specific attempt was recorded</span>
    <span class="kd">func</span> <span class="nf">verifyAttempt</span><span class="p">(</span><span class="nv">username</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">success</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">recordedAttempts</span><span class="o">.</span><span class="n">contains</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="n">username</span> <span class="o">==</span> <span class="n">username</span> <span class="o">&amp;&amp;</span> <span class="nv">$0</span><span class="o">.</span><span class="n">success</span> <span class="o">==</span> <span class="n">success</span> <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="c1">// Helper method to check the total number of attempts</span>
    <span class="kd">func</span> <span class="nf">verifyTotalAttempts</span><span class="p">(</span><span class="nv">expectedCount</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">recordedAttempts</span><span class="o">.</span><span class="n">count</span> <span class="o">==</span> <span class="n">expectedCount</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>We can see that the <code class="language-plaintext highlighter-rouge">SpySecurityHelper</code> is more simple than the original implementation, the spy test double records all attempts of login, and checks the side effects of the dependency.</p>

<h2 id="5-mocks">5. Mocks</h2>

<p>A <strong>mock</strong> is the most sophisticated type of test double. It allows you to set expectations about interactions with the object and verify that those expectations are met. Mocks are often used in combination with testing frameworks.</p>

<h3 id="example-4">Example:</h3>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// MockNotificationService.swift</span>
<span class="kd">class</span> <span class="kt">MockNotificationService</span><span class="p">:</span> <span class="kt">NotificationService</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">sentEmails</span><span class="p">:</span> <span class="p">[(</span><span class="nv">username</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">success</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="kd">func</span> <span class="nf">sendRegistrationEmail</span><span class="p">(</span><span class="nv">username</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">success</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">sentEmails</span><span class="o">.</span><span class="nf">append</span><span class="p">((</span><span class="n">username</span><span class="p">,</span> <span class="n">success</span><span class="p">))</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">sendAuthenticationEmail</span><span class="p">(</span><span class="nv">username</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">success</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">sentEmails</span><span class="o">.</span><span class="nf">append</span><span class="p">((</span><span class="n">username</span><span class="p">,</span> <span class="n">success</span><span class="p">))</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">sendFailedAuthenticationAttemptEmail</span><span class="p">(</span><span class="nv">username</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">success</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">sentEmails</span><span class="o">.</span><span class="nf">append</span><span class="p">((</span><span class="n">username</span><span class="p">,</span> <span class="n">success</span><span class="p">))</span>
    <span class="p">}</span>

    <span class="c1">// Helper to verify that an email was sent</span>
    <span class="kd">func</span> <span class="nf">verifyEmailSent</span><span class="p">(</span><span class="n">to</span> <span class="nv">username</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">success</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">sentEmails</span><span class="o">.</span><span class="n">contains</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="n">username</span> <span class="o">==</span> <span class="n">username</span> <span class="o">&amp;&amp;</span> <span class="nv">$0</span><span class="o">.</span><span class="n">success</span> <span class="o">==</span> <span class="n">success</span> <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="c1">// Helper to verify the total number of emails sent</span>
    <span class="kd">func</span> <span class="nf">verifyTotalEmailsSent</span><span class="p">(</span><span class="nv">expectedCount</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">sentEmails</span><span class="o">.</span><span class="n">count</span> <span class="o">==</span> <span class="n">expectedCount</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="sample-code">Sample Code</h2>

<p>It’s best to use a real project to test our the code, you can download the source code <a href="assets/test_doubles.zip">Here</a>.</p>

<!-- _includes/centered-image.html -->
<div class="centered-image">
  <img src="/images/posts/auth_screen.webp" alt="" class="centered-image__img" />
  <p align="center">
    <em>Simple SwiftUI Screen</em>
  </p>
</div>

<h2 id="conclusion">Conclusion</h2>

<p>Test doubles are a powerful concept that can significantly improve the reliability and maintainability of your tests. Whether you’re using dummies, fakes, stubs, spies, or mocks, each type of test double serves a unique purpose in ensuring your code is thoroughly tested in isolation.</p>

<p>By understanding when and how to use each type, you’ll be able to write more focused and effective unit tests in Swift, ensuring your code is both high quality and easier to maintain.</p>

<p><strong>Happy testing!</strong> 🎉</p>

    
    </section>

    <!-- Social media shares -->
    

<div class="share-buttons">
    <ul class="share-buttons">
        <li class="meta">Share</li>
        
        <li>
            <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/test-doubles-in-swift/" target="_blank"
               title=" Facebook">
                <i class="fab fa-facebook-square fa-2x" aria-hidden="true"></i>
                <span class="sr-only">Share on Facebook</span>
            </a>
        </li>
         
        <li>
            <a href="https://twitter.com/intent/tweet?text=Test+Doubles+In+Swift%20http%3A%2F%2Flocalhost%3A4000%2Ftest-doubles-in-swift%2F"
               target="_blank" title="">
                <i class="fab fa-twitter-square fa-2x" aria-hidden="true"></i>
                <span class="sr-only">Tweet</span>
            </a>
        </li>
            
        <li>
            <a href="https://www.reddit.com/submit?url=http://localhost:4000/test-doubles-in-swift/&title=Test+Doubles+In+Swift%20%7C%20Swift+By+Deya"
               target="_blank" title=" Reddit">
                <i class="fab fa-reddit-square fa-2x" aria-hidden="true"></i>
                <span class="sr-only">Share on Reddit</span>
            </a>
        </li>
         
        <li>
            <a href="https://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/test-doubles-in-swift/&title=Test+Doubles+In+Swift%20%7C%20Swift+By+Deya&summary=&source=http://localhost:4000/test-doubles-in-swift/"
               target="_blank" title=" LinkedIn">
                <i class="fab fa-linkedin fa-2x" aria-hidden="true"></i>
                <span class="sr-only">Share on LinkedIn</span>
            </a>
        </li>
          
        <li>
            <a href="mailto:?subject=Test Doubles In Swift%20%7C%20Swift By Deya&body=http://localhost:4000/test-doubles-in-swift/"
               target="_blank" title="">
                <i class="fas fa-envelope-square fa-2x" aria-hidden="true"></i>
                <span class="sr-only">Email</span></a>
        </li>
        
    </ul>
</div>




    <!-- Tag list -->
    
    


  <div class="tag-list">
    <ul>
      
        <li class="meta">Tags</li>
      

      
        <li><a class="button" href="http://localhost:4000/tag#Development">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> Development</p>
        </a></li>
      
        <li><a class="button" href="http://localhost:4000/tag#Programming">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> Programming</p>
        </a></li>
      
        <li><a class="button" href="http://localhost:4000/tag#Swift">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> Swift</p>
        </a></li>
      
        <li><a class="button" href="http://localhost:4000/tag#iOS">
          <p><i class="fas fa-tag fa-fw fa-sm"></i> iOS</p>
        </a></li>
      
    </ul>
  </div>



</article>




<!-- To change color of links in the page --> <style> header#main { background-size: cover; background-repeat: no-repeat; background-position: center; } </style> <!-- Post navigation --> <div id="post-nav"> <div id="previous-post"> <a alt="MacBooks with Silicon Chips and Proposed Solutions" href="/solving-network-issues-on-macbooks-silicon-chips/"> <p>Previous post</p> MacBooks with Silicon Chips and Proposed Solutions </a> </div> <div id="next-post"> <a alt="iOS Accessibility Basics" href="/ios-accessibility/"> <p>Next post</p> iOS Accessibility Basics </a> </div> </div> <!--Utterances--> <!-- Cusdis --> <!-- Disqus -->


    </div>
    
    <footer class="site-footer"> <p class="text"> Swift Insights: A Curated Collection of Weekly Articles Exploring the Depths of iOS Development </p> <div class="footer-icons"> <ul> <!-- Social icons from Font Awesome, if enabled --> <li> <a feed.xml href="/feed.xml" title="Follow RSS feed" target="_blank"> <span class="fa-stack fa-lg"> <i class="fas fa-circle fa-stack-2x"></i> <i class="fas fa-rss fa-stack-1x fa-inverse"></i> </span> </a> </li> <li> <a href="https://github.com/deya-eldeen" title="Follow on Github" target="_blank" rel="noopener"> <span class="fa-stack fa-lg"> <i class="fas fa-circle fa-stack-2x"></i> <i class="fab fa-github fa-stack-1x fa-inverse"></i> </span> </a> </li> <li> <a href="https://www.linkedin.com/in/deya-eldeen-elkhawaldeh-47908662" title="Follow on Linkedin" target="_blank" rel="noopener"> <span class="fa-stack fa-lg"> <i class="fas fa-circle fa-stack-2x"></i> <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i> </span> </a> </li> <li> <a href="mailto:deyaeldeenk@gmail.com"" title="Follow on Mail" target="_blank" rel="noopener"> <span class="fa-stack fa-lg"> <i class="fas fa-circle fa-stack-2x"></i> <i class="fas fa-envelope fa-stack-1x fa-inverse"></i> </span> </a> </li> <li> <a href="https://twitter.com/deya_eldeen" title="Follow on Twitter" target="_blank" rel="noopener"> <span class="fa-stack fa-lg"> <i class="fas fa-circle fa-stack-2x"></i> <i class="fab fa-twitter fa-stack-1x fa-inverse"></i> </span> </a> </li> </ul> </div> </footer>
  </body>
</html>
